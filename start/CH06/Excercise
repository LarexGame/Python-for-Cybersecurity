import random
import hashlib
import requests

# Character sets
lower = "abcdefghijklmnopqrstuvwxyz"
upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
digits = "0123456789"
symbols = "!@#$%^&*()-_=+[]{}|;:,.<>?/"

# Combine all characters
all_chars = lower + upper + digits + symbols

def generate_password(length=12):
    return ''.join(random.choice(all_chars) for _ in range(length))

def check_pwned(password):
    # Use k-Anonymity model: only send first 5 chars of SHA1 hash
    sha1 = hashlib.sha1(password.encode('utf-8')).hexdigest().upper()
    prefix, suffix = sha1[:5], sha1[5:]
    url = f"https://api.pwnedpasswords.com/range/{prefix}"
    response = requests.get(url)
    if response.status_code != 200:
        raise RuntimeError("Error fetching data from HaveIBeenPwned API")
    hashes = (line.split(':') for line in response.text.splitlines())
    return any(h == suffix for h, _ in hashes)

# Generate and check password
password = generate_password()
if check_pwned(password):
    print(":warning: Password has been compromised. Try again.")
else:
    print(":white_check_mark: Secure password:", password)