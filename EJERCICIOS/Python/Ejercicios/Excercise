import crypt

def load_shadow_file(filename):
    users = {}
    with open(filename, 'r') as f:
        for line in f:
            parts = line.strip().split(':')
            username = parts[0]
            hash_parts = parts[1].split('$')
            if len(hash_parts) >= 4:
                algo = hash_parts[1]
                salt = hash_parts[2]
                full_salt = f"${algo}${salt}"
                hashed = parts[1]
                users[username] = (full_salt, hashed)
    return users

def crack_passwords(shadow_file, password_file):
    users = load_shadow_file(shadow_file)
    cracked = {}

    with open(password_file, 'r', encoding='utf-8', errors='ignore') as f:
        passwords = [line.strip() for line in f]

    for username, (salt, hashed_pw) in users.items():
        for password in passwords:
            if crypt.crypt(password, salt) == hashed_pw:
                cracked[username] = password
                print(f"[+] Found password for {username}: {password}")
                break

    return cracked

# Example usage:
cracked = crack_passwords('shadow.txt', 'passwords_100.txt')
print(f"\nTotal cracked: {len(cracked)}")
